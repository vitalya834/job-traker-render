import{_ as ne,u as oe,c as W,a as le,r as h,w as re,o as ie,b as n,d as e,e as c,t as s,f as r,n as N,g as ue,h as _,F as U,i as G,j as ce,v as de,k as ve,l as S,m as pe,p as o}from"./index-P9PE9f3C.js";const he={class:"parsed-job-container"},_e={class:"back-button-container"},ye={key:1,class:"parsing-progress"},ge={key:2,class:"loading"},me={key:3,class:"error"},ke={class:"error-content"},be={key:0,class:"error-details"},fe={class:"error-actions"},we={key:4,class:"parsed-job-content"},Ie={class:"parsed-job-header"},Te={class:"company"},De={key:0,class:"company-rating"},Le={key:0,class:"location"},je={key:1,class:"salary"},xe={key:2,class:"seniority"},Ce={class:"source-info"},Ee={key:0,class:"source-label"},Pe={key:2,class:"parsed-date"},Me={key:3,class:"original-link"},Re=["href"],$e={key:4,class:"parsing-note"},Je={class:"view-tabs"},Ne=["onClick"],Se={class:"tab-content"},Ae={key:0,class:"description-tab"},Ve={class:"search-container"},qe={class:"search-input-container"},Fe=["placeholder"],Oe={key:0,class:"search-actions"},ze={class:"search-count"},Be={key:0,class:"search-results"},He={key:0,class:"keywords-section"},Ke={class:"tags-container"},We=["onClick"],Ue={key:1,class:"screenshot-tab"},Ge={class:"screenshot-container"},Qe=["src"],Ze={key:0,class:"screenshot-error"},Xe={key:2,class:"html-tab"},Ye=["src"],es={key:0,class:"html-error"},ss={key:3,class:"parsing-tab"},ts={class:"parsing-info"},as={class:"info-section"},ns={key:0},os=["href"],ls={class:"info-section"},rs={key:0},is={key:1},us={key:2},cs={key:3},ds={key:4},vs={class:"info-section"},ps={key:0,class:"info-section error-section"},hs={key:5,class:"no-data"},_s={class:"no-data-content"},ys={key:0,class:"job-info-summary"},gs={key:0},ms={key:2,class:"no-link-warning"},ks={__name:"ParsedJobView",setup(bs){const{t}=oe(),A=le(),Q=pe(),T=W(()=>A.params.id),L=h(!0),f=h(null),w=h(null),a=h(null),g=h(null),I=h("description"),x=h(!1),R=h(!1),j=h(!1),C=h(!1),b=h(""),p=h({count:0,current:0}),V=h(""),q=h("success"),$=h(!1),D=h(0),E=h([]),k=h(null),Z=[{id:"description",label:t("description")},{id:"screenshot",label:t("screenshot")},{id:"html",label:t("htmlSource")},{id:"parsing",label:t("parsingInfo")}],X=W(()=>Z),F=u=>u?{linkedin:"LinkedIn","linkedin-api":"LinkedIn API","linkedin-embed":"LinkedIn Embed","linkedin-fallback":"LinkedIn (ограниченные данные)",indeed:"Indeed",glassdoor:"Glassdoor",generic:t("genericWebsite")}[u]||u:t("unknown"),P=(u,l="success")=>{V.value=u,q.value=l,$.value=!0,setTimeout(()=>{$.value=!1},4e3)},O=()=>{if(!b.value.trim()||!k.value){p.value={count:0,current:0};return}const u=k.value.innerText,l=b.value.trim().toLowerCase(),d=[];let v=u.toLowerCase().indexOf(l);for(;v!==-1;)d.push(v),v=u.toLowerCase().indexOf(l,v+1);p.value={count:d.length,current:d.length>0?1:0,matches:d},d.length>0&&J()},J=()=>{if(!k.value||!p.value.count)return;const u=k.value.innerText;k.value.innerHTML=u;const l=b.value.trim(),d=k.value.innerHTML,v=p.value.matches[p.value.current-1],y=d.substring(0,v),i=d.substring(v,v+l.length),m=d.substring(v+l.length);k.value.innerHTML=`${y}<span class="keyword-highlight">${i}</span>${m}`;const K=k.value.querySelector(".keyword-highlight");K&&K.scrollIntoView({behavior:"smooth",block:"center"})},z=()=>{p.value.count!==0&&(p.value.current=p.value.current%p.value.count+1,J())},Y=()=>{p.value.count!==0&&(p.value.current=p.value.current===1?p.value.count:p.value.current-1,J())},ee=u=>{if(!u)return[];const l=new Set(["the","and","or","a","an","in","on","at","to","for","with","by","about","из","в","на","и","или","с","для","о","по","от","к","за"]),d=/\b[A-Za-zА-Яа-я0-9][\w\+\#\.]*\b/g,v=u.match(d)||[],y={};return v.forEach(i=>{const m=i.toLowerCase();!l.has(m)&&m.length>1&&(y[m]=(y[m]||0)+1)}),Object.entries(y).sort((i,m)=>m[1]-i[1]).slice(0,15).map(([i,m])=>({word:i,freq:m}))},M=async()=>{var u,l,d,v;L.value=!0,f.value=null,w.value=null,R.value=!1,j.value=!1,b.value="",p.value={count:0,current:0},E.value=[];try{const y=await S.get(`/api/jobs/${T.value}`);if(g.value=y.data,x.value=!!g.value.link,g.value.isParsed)try{const i=await S.get(`/api/jobs/${T.value}/parsed`);if(i.data.success)a.value=i.data.parsedData,I.value=a.value.description?"description":"screenshot",a.value.description&&setTimeout(()=>{E.value=ee(a.value.description)},500),a.value.sourceType&&a.value.sourceType.includes("linkedin")&&(a.value.isLinkedIn=!0,a.value.note&&a.value.note.includes("ограничен")&&setTimeout(()=>{P(t("linkedinLimitedDataWarning"),"warning")},1e3));else throw new Error(t("errorLoadingParsedData"))}catch(i){console.error("Ошибка при загрузке распарсенных данных:",i),f.value=((l=(u=i.response)==null?void 0:u.data)==null?void 0:l.error)||t("errorLoadingParsedData"),w.value=i.message,a.value=null}else a.value=null}catch(y){console.error("Ошибка при загрузке данных о вакансии:",y),f.value=((v=(d=y.response)==null?void 0:d.data)==null?void 0:v.error)||t("errorLoadingData"),w.value=y.message,g.value=null,a.value=null}finally{L.value=!1}},B=async()=>{var l,d,v,y;if(C.value)return;C.value=!0,L.value=!0,f.value=null,w.value=null,D.value=0;const u=setInterval(()=>{D.value<95&&(D.value+=Math.random()*5+2)},700);try{P(t("parsingInProgress"),"info");const i=await S.post(`/api/jobs/${T.value}/parse`);if(clearInterval(u),D.value=100,i.data.success)P(t("parsingSuccess"),"success"),setTimeout(async()=>{await M()},500);else throw new Error(i.data.error||t("errorParsingJob"))}catch(i){clearInterval(u),D.value=0,console.error("Ошибка при парсинге вакансии:",i),f.value=((d=(l=i.response)==null?void 0:l.data)==null?void 0:d.error)||t("errorParsingJob"),w.value=((y=(v=i.response)==null?void 0:v.data)==null?void 0:y.details)||i.message,P(t("parsingError"),"error")}finally{L.value=!1,C.value=!1}},se=()=>{R.value=!0},te=()=>{try{const u=document.querySelector(".html-frame");u&&u.contentDocument&&u.contentDocument.body.innerHTML.includes("error")?j.value=!0:j.value=!1}catch{j.value=!0}},H=u=>{if(!u)return"";const l=new Date(u);return new Intl.DateTimeFormat(navigator.language||"ru-RU",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}).format(l)},ae=()=>{Q.back()};return re(()=>A.params.id,(u,l)=>{u!==l&&M()}),ie(()=>{M()}),(u,l)=>{var d,v,y;return o(),n("div",he,[e("div",_e,[e("button",{onClick:ae,class:"back-button"}," ← "+s(r(t)("backToList")),1)]),$.value?(o(),n("div",{key:0,class:N(["toast-message",q.value])},s(V.value),3)):c("",!0),C.value?(o(),n("div",ye,[e("div",{class:"parsing-progress-bar",style:ue({width:`${D.value}%`})},null,4)])):c("",!0),L.value?(o(),n("div",ge,[l[1]||(l[1]=e("div",{class:"spinner"},null,-1)),e("p",null,s(r(t)("loadingJobData")),1)])):f.value?(o(),n("div",me,[e("div",ke,[e("h3",null,s(r(t)("error")),1),e("p",null,s(f.value),1),w.value?(o(),n("div",be,[e("details",null,[e("summary",null,s(r(t)("technicalDetails")),1),e("pre",null,s(w.value),1)])])):c("",!0),e("div",fe,[e("button",{onClick:M,class:"retry-btn"},[e("span",null,s(r(t)("retry")),1)]),x.value?(o(),n("button",{key:0,onClick:B,class:"parse-btn"},[e("span",null,s(r(t)("parseNow")),1)])):c("",!0)])])])):a.value?(o(),n("div",we,[e("div",Ie,[e("h2",null,s(a.value.title||((d=g.value)==null?void 0:d.position)||r(t)("unknownPosition")),1),e("div",Te,[_(s(a.value.company||((v=g.value)==null?void 0:v.company)||r(t)("unknownCompany"))+" ",1),a.value.companyRating?(o(),n("span",De," ("+s(r(t)("rating"))+": "+s(a.value.companyRating)+") ",1)):c("",!0)]),a.value.location?(o(),n("div",Le,[l[2]||(l[2]=e("span",{class:"location-icon"},"📍",-1)),_(" "+s(a.value.location),1)])):c("",!0),a.value.salary?(o(),n("div",je,[l[3]||(l[3]=e("span",{class:"salary-icon"},"💰",-1)),_(" "+s(a.value.salary),1)])):c("",!0),a.value.seniority?(o(),n("div",xe,[l[4]||(l[4]=e("span",{class:"seniority-icon"},"👨‍💼",-1)),_(" "+s(a.value.seniority),1)])):c("",!0),e("div",Ce,[a.value.sourceType?(o(),n("span",Ee,s(r(t)("source"))+":",1)):c("",!0),a.value.sourceType?(o(),n("span",{key:1,class:N(["source-type",a.value.sourceType])},s(F(a.value.sourceType)),3)):c("",!0),a.value.parsedAt?(o(),n("span",Pe,s(r(t)("parsedOn"))+": "+s(H(a.value.parsedAt)),1)):c("",!0)]),a.value.url?(o(),n("div",Me,[e("a",{href:a.value.url,target:"_blank",rel:"noopener noreferrer"},s(r(t)("openOriginalPage")),9,Re)])):c("",!0),a.value.note?(o(),n("div",$e,[l[5]||(l[5]=e("span",{class:"note-icon"},"ℹ️",-1)),_(" "+s(a.value.note),1)])):c("",!0)]),e("div",Je,[(o(!0),n(U,null,G(X.value,i=>(o(),n("button",{key:i.id,onClick:m=>I.value=i.id,class:N([{active:I.value===i.id},"tab-btn"])},s(i.label),11,Ne))),128))]),e("div",Se,[I.value==="description"?(o(),n("div",Ae,[e("div",Ve,[e("div",qe,[ce(e("input",{"onUpdate:modelValue":l[0]||(l[0]=i=>b.value=i),onInput:O,onKeydown:ve(z,["enter"]),type:"text",class:"search-input",placeholder:r(t)("searchInDescription")},null,40,Fe),[[de,b.value]]),p.value.count>0?(o(),n("div",Oe,[e("button",{onClick:Y,class:"search-nav-btn"}," ▲ "),e("span",ze,s(p.value.current)+" / "+s(p.value.count),1),e("button",{onClick:z,class:"search-nav-btn"}," ▼ ")])):c("",!0)]),b.value&&p.value.count===0?(o(),n("div",Be,s(r(t)("noResultsFound")),1)):c("",!0)]),e("div",{class:"job-text",ref_key:"jobDescriptionRef",ref:k},s(a.value.description),513),E.value.length>0?(o(),n("div",He,[e("h4",null,s(r(t)("keywordsInJob")),1),e("div",Ke,[(o(!0),n(U,null,G(E.value,i=>(o(),n("div",{key:i.word,class:"tag",onClick:m=>{b.value=i.word,O()}},s(i.word),9,We))),128))])])):c("",!0)])):I.value==="screenshot"?(o(),n("div",Ue,[e("div",Ge,[e("img",{src:`/api/jobs/${T.value}/screenshot`,alt:"Job Screenshot",class:"job-screenshot",onError:se,ref:"screenshotImg"},null,40,Qe),R.value?(o(),n("div",Ze,[e("p",null,s(r(t)("screenshotError")),1)])):c("",!0)])])):I.value==="html"?(o(),n("div",Xe,[e("iframe",{src:`/api/jobs/${T.value}/html`,class:"html-frame",onLoad:te,ref:"htmlIframe"},null,40,Ye),j.value?(o(),n("div",es,[e("p",null,s(r(t)("htmlError")),1)])):c("",!0)])):I.value==="parsing"?(o(),n("div",ss,[e("div",ts,[e("h3",null,s(r(t)("parsingInfo")),1),e("div",as,[e("h4",null,s(r(t)("source")),1),e("p",null,[e("strong",null,s(r(t)("sourceType"))+":",1),_(" "+s(F(a.value.sourceType)),1)]),a.value.url?(o(),n("p",ns,[l[6]||(l[6]=e("strong",null,"URL:",-1)),l[7]||(l[7]=_()),e("a",{href:a.value.url,target:"_blank"},s(a.value.url),9,os)])):c("",!0)]),e("div",ls,[e("h4",null,s(r(t)("parsedData")),1),a.value.title?(o(),n("p",rs,[e("strong",null,s(r(t)("title"))+":",1),_(" "+s(a.value.title),1)])):c("",!0),a.value.company?(o(),n("p",is,[e("strong",null,s(r(t)("company"))+":",1),_(" "+s(a.value.company),1)])):c("",!0),a.value.location?(o(),n("p",us,[e("strong",null,s(r(t)("location"))+":",1),_(" "+s(a.value.location),1)])):c("",!0),a.value.salary?(o(),n("p",cs,[e("strong",null,s(r(t)("salary"))+":",1),_(" "+s(a.value.salary),1)])):c("",!0),a.value.seniority?(o(),n("p",ds,[e("strong",null,s(r(t)("seniority"))+":",1),_(" "+s(a.value.seniority),1)])):c("",!0)]),e("div",vs,[e("h4",null,s(r(t)("metadata")),1),e("p",null,[e("strong",null,s(r(t)("parsedAt"))+":",1),_(" "+s(H(a.value.parsedAt)),1)]),e("p",null,[e("strong",null,s(r(t)("jobId"))+":",1),_(" "+s(T.value),1)])]),a.value.error?(o(),n("div",ps,[e("h4",null,s(r(t)("parsingError")),1),e("p",null,s(a.value.message),1)])):c("",!0)])])):c("",!0)])])):(o(),n("div",hs,[e("div",_s,[l[9]||(l[9]=e("div",{class:"no-data-icon"},"🔍",-1)),e("h3",null,s(r(t)("noDataAvailable")),1),e("p",null,s(r(t)("noDataDescription")),1),g.value?(o(),n("div",ys,[e("p",null,[e("strong",null,s(r(t)("company"))+":",1),_(" "+s(g.value.company),1)]),e("p",null,[e("strong",null,s(r(t)("position"))+":",1),_(" "+s(g.value.position),1)]),g.value.link?(o(),n("p",gs,[e("strong",null,s(r(t)("link"))+":",1),_(" "+s(g.value.link),1)])):c("",!0)])):c("",!0),x.value?(o(),n("button",{key:1,onClick:B,class:"parse-btn main-action"},[l[8]||(l[8]=e("span",{class:"parse-icon"},"🔄",-1)),_(" "+s(r(t)("parseNow")),1)])):c("",!0),!x.value&&!((y=g.value)!=null&&y.link)?(o(),n("div",ms,[e("p",null,s(r(t)("noLinkWarning")),1)])):c("",!0)])]))])}}},ws=ne(ks,[["__scopeId","data-v-bf7d35f5"]]);export{ws as default};
